<!DOCTYPE html>
<html><head><meta charset="ISO-8859-1"><title>CJD &ndash; cjd.texturize</title><link href="cjd-r.css" rel="stylesheet" type="text/css"></head><body><div class="ns" id="top">cjd.texturize</div><div class="desc"><p>Parser for CJD comments, wherein a CJD-comment in the form of a sequence of Clojure forms is parsed into an abstract syntax tree. The resulting AST then serves as the basis for HTML generation. </p></div><div class="desc"><table class="summary"><tbody><tr><td colspan="2"><p class="sum-hdr">Constructo Summary</p></td></tr><tr class="sum"><td><a href="#Element">Element</a></td><td>Describes elements for the comment parsing process. </td></tr><tr><td colspan="2"><p class="sum-hdr">Function/Macro Summary</p></td></tr><tr class="sum"><td><a href="#flow-run">flow-run</a></td><td>Processes a sequence of CJD comment-content forms into a sequence of flow-forms, which will in turn contain phrasing and text content. </td></tr><tr class="sum"><td><a href="#mk-ph">mk-ph</a></td><td>Makes a phrase element and adds it to the phrase-element map used by the CJD comment parser. </td></tr><tr class="sum"><td><a href="#mk-phx">mk-phx</a></td><td>Makes a phrase-form and adds it to the phrase-form map used by the CJD comment parser. </td></tr><tr class="sum"><td><a href="#parse-comment">parse-comment</a></td><td>Parser for CJD comment content. </td></tr><tr class="sum"><td><a href="#phrasing-run">phrasing-run</a></td><td>Parses the phrasing content within a flow into a tree of phrasing elements and forms, and text nodes. </td></tr><tr class="sum"><td><a href="#text-run">text-run</a></td><td>Works through a list of comment text, turning it into a string. </td></tr></tbody></table></div><div class="artifact" id="Element"><table class="topline"><tbody><tr><td><span class="itemname">Element</span></td><td align="right"><span class="itemtype">constructo</span> in <a href="#top">cjd.texturize</a></td></tr></tbody></table><div class="desc"><p>Describes elements for the comment parsing process. </p><p>There are several classes of elements; all share the same structure, but are segregated into different maps corresponding to different syntactic entities. Not pretty, but it does allow tags like &quot;arg&quot; to be used for both phrasing and flow forms. </p></div></div><div class="artifact" id="flow-run"><table class="topline"><tbody><tr><td><span class="itemname">flow-run</span></td><td align="right"><span class="itemtype">function</span> in <a href="#top">cjd.texturize</a></td></tr></tbody></table><p class="decl"><span class="expr">(<span class="n0">flow-run</span> [<span class="n1">context</span> <span class="n1">contents</span>])</span></p><div class="desc"><p>Processes a sequence of CJD comment-content forms into a sequence of flow-forms, which will in turn contain phrasing and text content. </p><div class="s1"><p class="v1"><span class="k1">Arguments</span></p><p class="a1"><span class="n1">context</span> &mdash; The context map. </p><p class="a1"><span class="n1">contents</span> &mdash; A sequence of input forms to be parsed. </p></div><div class="s1"><p class="v1"><span class="k1">Returns</span></p><p class="a1"><p>A tuple of the form <code>[<span class="n2">flows</span> <span class="n2">remaining</span>]</code>, where </p><div class="s"><p class="v"><span class="k">Arguments</span></p><p class="a"><span class="n2">flows</span> &mdash; A sequence of flow nodes describing the parsed content </p><p class="a"><span class="n2">remaining</span> &mdash; Any unparsed forms in the input sequence. </p></div></p></div></div></div><div class="artifact" id="mk-ph"><table class="topline"><tbody><tr><td><span class="itemname">mk-ph</span></td><td align="right"><span class="itemtype">function</span> in <a href="#top">cjd.texturize</a></td></tr></tbody></table><p class="decl"><span class="expr">(<span class="n0">mk-ph</span> [<span class="n1">tags</span> <span class="n1">desc</span> <span class="n1">new-fn</span>])</span></p><div class="desc"><p>Makes a phrase element and adds it to the phrase-element map used by the CJD comment parser. </p><div class="s1"><p class="v1"><span class="k1">Arguments</span></p><p class="a1"><span class="n1">tags</span> &mdash; A list of tag symbols. These are the symbols that are used with &quot;@&quot; to specify the phrase element, e.g. <code>'b </code> for the <code>@(b ...) </code> phrase element for bold text. </p><p class="a1"><span class="n1">desc</span> &mdash; A string containing a very short description of the phrase element. </p><p class="a1"><span class="n1">new-fn</span> &mdash; A function that creates an object to represent the phrase element and its contents in the parse tree. It has the form <code>(fn [<span class="n2">context</span> <span class="n2">content</span>])</code>, where </p><div class="s"><p class="v"><span class="k">Arguments</span></p><p class="a"><span class="n2">context</span> &mdash; The context map currently in force. </p><p class="a"><span class="n2">content</span> &mdash; The subtree of phrasing content to be contained within the phrasing element. </p></div><div class="s"><p class="v"><span class="k">Returns</span></p><p class="a"><p>An object representing the phrase element and its content. </p></p></div></div><div class="s1"><p class="v1"><span class="k1">Returns</span></p><p class="a1"><p>nil. </p></p></div></div></div><div class="artifact" id="mk-phx"><table class="topline"><tbody><tr><td><span class="itemname">mk-phx</span></td><td align="right"><span class="itemtype">function</span> in <a href="#top">cjd.texturize</a></td></tr></tbody></table><p class="decl"><span class="expr">(<span class="n0">mk-phx</span> [<span class="n1">tags</span> <span class="n1">desc</span> <span class="n1">arity</span> <span class="n1">new-fn</span>])</span></p><div class="desc"><p>Makes a phrase-form and adds it to the phrase-form map used by the CJD comment parser. </p><div class="s1"><p class="v1"><span class="k1">Arguments</span></p><p class="a1"><span class="n1">tags</span> &mdash; A list of tag symbols. These are the symbols that are used with &quot;@&quot; to specify the phrase form. </p><p class="a1"><span class="n1">desc</span> &mdash; A string containing a very short description of the phrase form. </p><p class="a1"><span class="n1">arity</span> &mdash; The number of arguments that should follow the tag. If a tag supports multiple arities, use a separate invocation of <span class="n0">mk-phx</span> for each arity. </p><p class="a1"><span class="n1">new-fn</span> &mdash; A function that creates an object representing the phrase-form and serving as its node in the comment's AST. This function has the form <code>(fn [<span class="n2">context</span> <span class="n2">other-params...</span>])</code>, where </p><div class="s"><p class="v"><span class="k">Arguments</span></p><p class="a"><span class="n2">context</span> &mdash; The <span class="nolink">Context</span> object then in force. </p><p class="a"><span class="n2">other-params...</span> &mdash; Other, additional parameters as necessary. The number of these parameters must match the value specified for <span class="n1">arity</span> . </p></div><div class="s"><p class="v"><span class="k">Returns</span></p><p class="a"><p>An object representing the phrasing form and its content. </p></p></div></div><div class="s1"><p class="v1"><span class="k1">Returns</span></p><p class="a1"><p>nil. </p></p></div></div></div><div class="artifact" id="parse-comment"><table class="topline"><tbody><tr><td><span class="itemname">parse-comment</span></td><td align="right"><span class="itemtype">function</span> in <a href="#top">cjd.texturize</a></td></tr></tbody></table><p class="decl"><span class="expr">(<span class="n0">parse-comment</span> [<span class="n1">context</span> <span class="n1">contents</span>])</span></p><div class="desc"><p>Parser for CJD comment content. </p><div class="s1"><p class="v1"><span class="k1">Arguments</span></p><p class="a1"><span class="n1">context</span> &mdash; The context map. </p><p class="a1"><span class="n1">contents</span> &mdash; The CJD comment, notionally as delivered from the CJD reader-hack. It must start with the appropriate symbol, <code>cjd!doc </code>, or it will be rejected. </p></div><div class="s1"><p class="v1"><span class="k1">Returns</span></p><p class="a1"><p>A sequence of flow objects representing the AST of the comment. </p></p></div></div></div><div class="artifact" id="phrasing-run"><table class="topline"><tbody><tr><td><span class="itemname">phrasing-run</span></td><td align="right"><span class="itemtype">function</span> in <a href="#top">cjd.texturize</a></td></tr></tbody></table><p class="decl"><span class="expr">(<span class="n0">phrasing-run</span> [<span class="n1">context</span> <span class="n1">form-contents</span>])</span></p><div class="desc"><p>Parses the phrasing content within a flow into a tree of phrasing elements and forms, and text nodes. </p><p>Syntactically, this consists of chunks of &quot;text&quot; interspersed with tagged forms, either open &agrave; la &quot;@name&quot; or closed, like &quot;@(b bold-text)&quot; </p><p><span class="n0">phrasing-run</span> essentially operates by determining what kind of item is next in its list of unprocessed content, and then invoking an appropriate processing function to operate on it. Each processing function does its thing for whatever scope is appropriate (possibly recursively invoking <span class="n0">phrasing-run</span> in the process), and returns whatever html it has generated, along with any unprocessed comment text. <span class="n0">phrasing-run</span> adds the generated HTML to its string, and then continues processing the remaining input. </p><div class="s1"><p class="v1"><span class="k1">Arguments</span></p><p class="a1"><span class="n1">form-contents</span> &mdash; The content of the source comment form to be processed. </p><p class="a1"><span class="n1">context</span> &mdash; The current context map. </p></div><div class="s1"><p class="v1"><span class="k1">Returns</span></p><p class="a1"><p>A tree of <a href="cjd.core-elements.html#Phrase">Phrase</a>, <a href="cjd.core-elements.html#PhraseForm">PhraseForm</a>, and <span class="nolink">Text</span> objects that collectively describe the phrasing content. </p></p></div></div></div><div class="artifact" id="text-run"><table class="topline"><tbody><tr><td><span class="itemname">text-run</span></td><td align="right"><span class="itemtype">function</span> in <a href="#top">cjd.texturize</a></td></tr></tbody></table><p class="decl"><span class="expr">(<span class="n0">text-run</span> [<span class="n1">context</span> <span class="n1">form-contents</span> <span class="n1">initial</span>])</span></p><div class="desc"><p>Works through a list of comment text, turning it into a string. </p><p>Processing continues for as long as the input is purely text, defined as being devoid of any directives. As soon as <span class="n0">text-run</span> encounters something non-textual, it quits and returns its text and whatever's left over for continued processing. </p><div class="s1"><p class="v1"><span class="k1">Arguments</span></p><p class="a1"><span class="n1">form-contents</span> &mdash; The content of the source comment form to be processed. </p><p class="a1"><span class="n1">context</span> &mdash; The current context map. </p><p class="a1"><span class="n1">initial</span> &mdash; If true, then this is the initial call to <span class="n0">text-run</span> within a phrasing run. The specific implication of this is that if this is a <i>not </i> the initial call, then the text run should assume that a space is needed for separation between the prior phrasing element and subsequent text (which is subject to normal rules for elimination), vs. the initial case, where no space is desirable. </p></div><div class="s1"><p class="v1"><span class="k1">Returns</span></p><p class="a1"><p>A tuple of the for <code>[<span class="n2">text</span> <span class="n2">unprocessed</span>]</code>, where: </p><div class="s"><p class="v"><span class="k">Arguments</span></p><p class="a"><span class="n2">text</span> &mdash; The string containing processed text. This is HTML-ized before being returned to the extent of doing the encoding of problematic characters like &lt;, &gt;, and &amp;, so that the returned string is ready-for-use HTML text. </p><p class="a"><span class="n2">unprocessed</span> &mdash; The unprocessed tail of <span class="n1">form-contents</span> . </p></div></p></div></div></div></body></html>